<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Build a Jenga game in Vision OS - Donovan's Vision Blog</title>
		<meta name="description" content="Create a simple Jenga-style game in Vision OS">
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/site.webmanifest">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Donovan’s Vision Blog">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="Donovan’s Vision Blog">

		<meta property="og:title" content="Build a Jenga game in Vision OS" />
		<meta property="og:type" content="article" />
		<meta property="og:description" content="Create a simple Jenga-style game in Vision OS">
		<meta property="og:url" content="" />
		<meta name="generator" content="Eleventy v2.0.1">
		<style>/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono,
		Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono,
		Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New,
		Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-70: rgba(255, 255, 255, 0.3);
	--color-gray-50: rgba(255, 255, 255, 0.5);
	--color-gray-20: rgba(255, 255, 255, 0.8);

	--background-color: #000;

	--text-color: var(--color-gray-20);
	--text-color-link: rgba(241, 233, 255, 0.8);
	--text-color-link-active: rgba(241, 233, 255, 1);
	--text-color-link-visited: rgba(241, 233, 255, 0.5);

	--syntax-tab-size: 2;
}

/* TODO: Make a proper dark theme? */
/* @media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #c0c0c0;
		--color-gray-70: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above 
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
} */

/* Global stylesheet */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
	/* TODO: Have this dynamically change by time of day */
	background: var(--background-color);
	background-image: url("/img/office.webp");
	background-size: 100vw;
	background-repeat: no-repeat;
}
html {
	overflow-y: scroll;
}

.bodyBackground {
	opacity: 0;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main {
	padding: 1rem 0;
}

.links-nextprev {
	list-style: none;
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	word-break: break-word;
}
pre:where([class*="language-"]) {
	width: 100%;
}
pre:not([class*="language-"]) {
	margin: 0.5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
}
code {
	word-break: break-all;
}

.panel {
	background-color: rgba(89, 89, 89, 0.2);
	box-shadow: -0.25px -0.25px 0.25px 0 rgba(255, 255, 255, 0.75),
		0 0 1rem 0 rgba(0, 0, 0, 0.1);
	border-radius: 2.5rem;
	position: relative;
	backdrop-filter: blur(20px);
	-webkit-backdrop-filter: blur(20px);
}

.padded {
	padding: 2rem;
}

@media (max-width: 500px) {
	.padded {
		padding: 1rem;
	}
}

/* Header */
.header-container {
	perspective: 100vw;
	perspective-origin: 50% 30vh;
	transform-style: preserve-3d;
}
header {
	font-family: var(--font-family-monospace);
	text-align: center;
	align-items: center;
	padding: 4rem 0;
	margin: 2rem auto 4rem;
	max-width: 90rem;
	z-index: 128;
}

@media (max-width: 90rem) {
	header {
		margin: 2rem 1rem 3rem;
	}
}

@media (max-width: 40rem) {
	header.panel {
		background: none;
		box-shadow: none;
		backdrop-filter: none;
		-webkit-backdrop-filter: none;
		margin: 2rem 1rem;
	}
}

.wordart {
	display: inline-block;
	margin: 2rem 0 4rem;
	font-size: 9vw;
	text-shadow: none;
	background: linear-gradient(
		183deg,
		rgba(183, 0, 255, 0.7) 10%,
		rgba(255, 21, 200, 0.7) 70%
	);
	background-clip: text;
	-webkit-background-clip: text;
	color: transparent;
	font-family: "Impact";
	transform: skewY(-8deg) scaleY(1.3) scaleX(0.8);
	-webkit-text-stroke: 1px rgba(255, 255, 255, 0.25);
}

.wordart-wrapper {
	filter: drop-shadow(2px 2px 0px rgba(2, 5, 42, 0.8));
}

@media (min-width: 1400px) {
	.wordart {
		font-size: 8rem;
	}
}

/* Nav */
nav {
	max-width: 22rem;
	margin: 0 auto;
	margin-bottom: -8rem;
}
nav.secondary {
	margin: 1rem auto 2rem;
}
.nav {
	display: flex;
	justify-content: space-between;
	padding: 1.5rem 1rem;
	list-style: none;
}
.nav-item {
	display: inline-block;
	padding: 0 1rem;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	color: #fff;
}

@media (max-width: 40rem) {
	nav {
		margin-bottom: -7rem;
	}
}

/* Internal header */
header.internal {
	display: flex;
	max-width: 100%;
	padding: 0;
	margin: 0;
}

header.internal .home-link {
	width: 300px;
	margin-right: auto;
}

header.internal .wordart {
	font-size: 2rem;
	margin: 0;
}

header.internal nav {
	background: none;
	box-shadow: none;
	filter: none;
	-webkit-backdrop-filter: none;
	max-width: 100%;
	margin: 2rem;
}

header.internal ul.nav {
	padding: 1rem 0 0;
}

@media (max-width: 500px) {
	header.internal,
	header,
	header.panel {
		display: block;
		max-width: 100%;
		padding: 0;
		margin: 2rem 0 0;
	}

	header .home-link {
		width: 300px;
		margin-right: auto;
	}

	header .wordart {
		font-size: 2rem;
		margin: 0;
	}

	nav,
	header .panel {
		background: none;
		box-shadow: none;
		filter: none;
		-webkit-backdrop-filter: none;
		max-width: 100%;
		margin: 2rem;
	}

	header .nav {
		padding: 1rem 0 0;
	}
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
}
.home.postlist {
	display: flex;
	flex-wrap: wrap;
	padding: 0 2rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
}

.home .postlist-item {
	margin: 1rem;
	max-width: calc(33% - 2rem);
	width: 100%;
	padding: 2rem;
}
@media (max-width: 70rem) {
	.home .postlist-item {
		max-width: calc(50% - 2rem);
	}
}

@media (max-width: 48rem) {
	.home .postlist-item {
		max-width: 100%;
	}
}

.nested .postlist-item {
	padding-top: 0;
	padding-bottom: 0;
}
.postlist-item time {
	width: 100%;
}
.postlist-item img,
main img {
	max-width: 100%;
	height: auto;
	margin: 3rem 0;
	border-radius: 2rem;
	box-shadow: -0.25px -0.25px 0.25px 0 rgba(255, 255, 255, 0.5),
		0 0 1rem 0 rgba(0, 0, 0, 0.2);
}

.video-wrapper {
	width: 100%;
}
main video {
	display: block;
	max-width: 80%;
	height: auto;
	border-radius: 2rem;
	box-shadow: -0.25px -0.25px 0.25px 0 rgba(255, 255, 255, 0.5),
		0 0 1rem 0 rgba(0, 0, 0, 0.2);
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-70);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}
.postlist h2,
.postlist h3,
.postlist h4 {
	display: block;
	width: 100%;
}

.more-posts {
	text-align: center;
	margin: 2rem 0;
}

.content {
	max-width: 54rem;
	margin-left: auto;
	margin-right: auto;
}
.content h2,
.content h3,
.content h4 {
	margin-top: 2rem;
	margin-bottom: 0;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	text-decoration: none;
	background: rgba(255, 255, 255, 0.1);
	padding: 0.25rem 0.5rem;
	border: 0.5px solid rgba(255, 255, 255, 0.25);
	border-radius: 1rem;
	box-shadow: -0.25px -0.25px 0.25px 0 rgba(255, 255, 255, 0.5),
		0 0 1rem 0 rgba(0, 0, 0, 0.2);
	font-size: 0.75em; /* 12px /16 */
	opacity: 0.5;
}
.post-tag:hover {
	opacity: 1;
	transition: opacity 0.25s ease-out;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: 0.5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: 0.1em;
	text-shadow: none;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

main h1,
main h2,
main h3,
main h4 {
	font-family: var(--font-family);
	width: 100%;
}

h2 + .header-anchor {
	font-size: 1.5em;
}

footer {
	max-width: 80rem;
	margin: 2rem auto;
	text-align: center;
}

@media (max-width: 90rem) {
	footer {
		margin: 1rem;
	}
}

.signup-frame {
	max-width: 375px;
	margin: 0 auto;
}</style>
		<script src="/js/on-scroll.js"></script>
	</head>
	<body>
		<div class="bodyBackground"></div>
		<a href="#skip" class="visually-hidden">Skip to main content</a>
			<header class="internal">
				<a href="/" class="home-link">
					<span class="wordart-wrapper">
						<span class="wordart">Donovan’s Vision Blog</span>
					</span>
				</a>
				<nav class="panel">
					<h2 class="visually-hidden">Top level navigation menu</h2>
					<ul class="nav">
						<li class="nav-item"><a href="/">Home</a></li>
						<li class="nav-item"><a href="/blog/">All Posts</a></li>
						<li class="nav-item"><a href="/links/">Cool Links</a></li>
					</ul>
				</nav>
			</header>
		<main id="skip" class="">
			
<div class="content panel padded">
	<h1>Build a Jenga game in Vision OS</h1>

<ul class="post-metadata">
	<li><time datetime="2024-06-28">28 June 2024</time></li>
	<li><a href="/tags/dev/" class="post-tag">dev</a></li>
	<li><a href="/tags/demo-project/" class="post-tag">demo project</a></li>
</ul>

<p>Building on the previous posts, we can put everything together into one demo.</p>
<blockquote class="imgur-embed-pub" lang="en" data-id="a/hmhTAbp" data-context="false">
  <a href="//imgur.com/a/hmhTAbp"></a>
</blockquote>
<script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script>
<p>This is the goal. To build an interactive Jenga-like brick tower game where the bricks can be removed (and stacked on top) until the tower falls over.</p>
<h2 id="finished-project" tabindex="-1">Finished project <a class="header-anchor" href="#finished-project">#</a></h2>
<p>You can <a href="https://files.vision.rodeo/xcode/jenga.zip">download the finished code here</a> as an Xcode project.</p>
<h2 id="topics-covered" tabindex="-1">Topics covered <a class="header-anchor" href="#topics-covered">#</a></h2>
<p>This work brings together all the previous topics we've covered including:</p>
<ul>
<li><a href="/immersive-spaces/">Setting up an immersive space</a></li>
<li><a href="/object-gravity/">Adding physics to an entity</a></li>
<li><a href="/multiple-objects/">Creating multiple 3D objects in code</a></li>
<li><a href="/advanced-gestures/">Adding gestures to an entity</a></li>
<li><a href="/hover-effect/">Hover effects on entities</a></li>
</ul>
<h2 id="getting-started" tabindex="-1">Getting started <a class="header-anchor" href="#getting-started">#</a></h2>
<p>Begin with a new Vision Pro app in Xcode. You don't need to change any defaults - we will set up the immersive space in code.</p>
<h2 id="creating-a-table-top-in-reality-composer-pro" tabindex="-1">Creating a table-top in Reality Composer Pro <a class="header-anchor" href="#creating-a-table-top-in-reality-composer-pro">#</a></h2>
<p>Before creating the game in code, we can try making and importing a scene from Reality Composer Pro. For this we'll create a simple &quot;table&quot; object to act as a stage on which the blocks can sit.</p>
<p>First, in your Xcode project, select <code>Packages</code> -&gt; <code>RealityKitContent</code> -&gt; <code>Package</code>, then on the top right select <code>Open in Reality Composer Pro</code>.</p>
<p>For this project we need a large flat surface. Here's how it will look:</p>
<p><picture><source type="image/avif" srcset="/img/F0A_zumFZG-3350.avif 3350w"><source type="image/webp" srcset="/img/F0A_zumFZG-3350.webp 3350w"><img alt="Reality Composer showing a 'table' object" loading="lazy" decoding="async" src="/img/F0A_zumFZG-3350.png" width="3350" height="1906"></picture></p>
<p>To add the floor, select the <code>+</code> on the bottom left of the scene contents list, then select <code>Primative Shape</code> -&gt; <code>Cube</code>. This adds a plain cube. On the top right, we can scale this to the shape needed by setting a scale of <code>1.5</code>, <code>0.02</code> and <code>1.5</code> for <code>x</code>, <code>y</code> and <code>z</code>. I then adjusted it down a little by setting the <code>Position</code> value of <code>y</code> to <code>-8</code>.</p>
<p>We need a material also. To add a material I select the <code>Show content library</code> on the top right (<code>+</code>). I chose a grey felt material and dragged it into the scene. Then in the cube object, under <code>Material Bindings</code>, select this material.</p>
<p>I then set up <code>connectors</code>.</p>
<h3 id="connectors-in-reality-composer-pro" tabindex="-1">Connectors in Reality Composer Pro <a class="header-anchor" href="#connectors-in-reality-composer-pro">#</a></h3>
<p>We configure the way the 3D object behaves by using connectors. On the right-hand panel select <code>Add Component</code> and add the following:</p>
<ul>
<li>Physics Body</li>
<li>Collision</li>
</ul>
<p>Within Physics body make sure <code>Mode</code> is set to <code>Static</code>. This means it won't fall with gravity.</p>
<p>Under Collision I just left everything default.</p>
<p>Lastly on the top left change the <code>Cube</code> name to <code>table</code>. We can now switch back to Xcode and use this object.</p>
<h2 id="window-and-immersive-views" tabindex="-1">Window and Immersive views <a class="header-anchor" href="#window-and-immersive-views">#</a></h2>
<p>We set up the two views as before, <code>WindowGroup</code> and <code>ImmersiveSpace</code>:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">JengaApp</span><span class="token punctuation">:</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> currentStyle<span class="token punctuation">:</span> <span class="token class-name">ImmersionStyle</span> <span class="token operator">=</span> <span class="token punctuation">.</span>mixed
    <span class="token attribute atrule">@StateObject</span> <span class="token keyword">var</span> viewModel <span class="token operator">=</span> <span class="token class-name">SharedViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">Scene</span> <span class="token punctuation">{</span>
        <span class="token class-name">WindowGroup</span> <span class="token punctuation">{</span>
            <span class="token class-name">ContentView</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">:</span> viewModel<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">defaultSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>

        <span class="token class-name">ImmersiveSpace</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"ImmersiveSpace"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ImmersiveView</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">:</span> viewModel<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">immersionStyle</span><span class="token punctuation">(</span>selection<span class="token punctuation">:</span> $currentStyle<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>mixed<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>This code also instantiates <code>SharedViewModel</code> and passes is into the two views. This will allow us to coordinate resetting the game and handle the game state. We create this later.</p>
<p>We need to set up a <code>Task</code> in our <code>ContentView</code> that loads the <code>ImmersiveSpace</code> when the app opens:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@ObservedObject</span> <span class="token keyword">var</span> viewModel<span class="token punctuation">:</span> <span class="token class-name">SharedViewModel</span>

    <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>openImmersiveSpace<span class="token punctuation">)</span> <span class="token keyword">var</span> openImmersiveSpace
    <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>dismissImmersiveSpace<span class="token punctuation">)</span> <span class="token keyword">var</span> dismissImmersiveSpace

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Jenga"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>extraLargeTitle<span class="token punctuation">)</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Reset game"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Code here to reset the game</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>task <span class="token punctuation">{</span>
            <span class="token keyword">await</span> <span class="token function">openImmersiveSpace</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"ImmersiveSpace"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>This sets the windowed view with a title and button to reset the game.</p>
<h2 id="adding-gestures" tabindex="-1">Adding Gestures <a class="header-anchor" href="#adding-gestures">#</a></h2>
<p>We can get some useful code for handling drag and rotate gestures when <a href="/advanced-gestures/">adding gestures to an entity</a>. Copy the files across from the <code>Packages -&gt; RealityKitContent -&gt; Sources -&gt; RealityKitContent</code> &quot;Components&quot; and &quot;Extensions&quot; folders.</p>
<p>We then set up the immersive view that will be shown.</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">ImmersiveView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@ObservedObject</span> <span class="token keyword">var</span> viewModel<span class="token punctuation">:</span> <span class="token class-name">SharedViewModel</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
        <span class="token class-name">RealityView</span> <span class="token punctuation">{</span> content <span class="token keyword">in</span>
            <span class="token comment">// Code here to load the scene and game pieces</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">installGestures</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">loadScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Entity</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">Entity</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Scene"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> realityKitContentBundle<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>This sets up the view and calls <code>installGestures</code> to make the gestures available.</p>
<h2 id="shared-view-model" tabindex="-1">Shared view model <a class="header-anchor" href="#shared-view-model">#</a></h2>
<p>We create a shared model as an <code>ObservableObject</code> in <code>SharedViewModel.swift</code>:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Foundation</span>
<span class="token keyword">import</span> <span class="token class-name">RealityKit</span>
<span class="token keyword">import</span> <span class="token class-name">RealityKitContent</span>
<span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">SharedViewModel</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span>
  <span class="token comment">// Starting positions for the table and game pieces</span>
  <span class="token keyword">let</span> startingPositionX<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.5</span>
  <span class="token keyword">let</span> startingPositionY<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">0.75</span>
  <span class="token keyword">let</span> startingPositionZ<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.75</span>
<span class="token punctuation">}</span></code></pre>
<p>We set it up with some initial data which we can use to ensure a consistent position for our game table and when placing the brick pieces.</p>
<h2 id="adding-floor-and-table" tabindex="-1">Adding floor and table <a class="header-anchor" href="#adding-floor-and-table">#</a></h2>
<p>We can add some code to our model to handle generating a floor:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">generateFloor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">ModelEntity</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> floor <span class="token operator">=</span> <span class="token class-name">ModelEntity</span><span class="token punctuation">(</span>
        mesh<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">generatePlane</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> depth<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        materials<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">OcclusionMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    floor<span class="token punctuation">.</span><span class="token function">generateCollisionShapes</span><span class="token punctuation">(</span>recursive<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    floor<span class="token punctuation">.</span>components<span class="token punctuation">[</span><span class="token class-name">PhysicsBodyComponent</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>
        massProperties<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span>
        mode<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">static</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> floor
<span class="token punctuation">}</span></code></pre>
<p>Then in <code>ImmersiveView</code>, we use this as well as loading the <code>table</code>:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token class-name">RealityView</span> <span class="token punctuation">{</span> content <span class="token keyword">in</span>
    <span class="token keyword">let</span> floor <span class="token operator">=</span> viewModel<span class="token punctuation">.</span><span class="token function">generateFloor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    content<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>floor<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token keyword">let</span> table <span class="token operator">=</span> <span class="token function">loadScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        table<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> viewModel<span class="token punctuation">.</span>startingPositionX <span class="token operator">+</span> viewModel<span class="token punctuation">.</span>pieceWidth
        table<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> viewModel<span class="token punctuation">.</span>startingPositionY
        table<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> viewModel<span class="token punctuation">.</span>startingPositionZ <span class="token operator">-</span> viewModel<span class="token punctuation">.</span>pieceWidth

        content<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>At this point we should have an empty table and a window. Next we add the brick pieces.</p>
<h2 id="generating-bricks" tabindex="-1">Generating bricks <a class="header-anchor" href="#generating-bricks">#</a></h2>
<p>In the <code>SharedViewModel</code> we can set up the logic to generate these brick pieces:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">SharedViewModel</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... other code</span>
  <span class="token keyword">let</span> numberOfRows <span class="token operator">=</span> <span class="token number">16</span>
  <span class="token keyword">let</span> pieceWidth<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">0.075</span>
  <span class="token keyword">let</span> pieceHeight<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">0.045</span>
  <span class="token keyword">let</span> pieceDepth<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">0.225</span>

  <span class="token comment">// ... more code to come here</span>
<span class="token punctuation">}</span></code></pre>
<p>First we set some more values to describe the width, height and depth / length of the pieces. These look ok for my demo and are based on the real proportions.</p>
<p>We then add a method to generate a model for each brick:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">generatePiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">ModelEntity</span> <span class="token punctuation">{</span>

  <span class="token comment">// Simple material</span>
  <span class="token keyword">var</span> defaultMaterial <span class="token operator">=</span> <span class="token class-name">PhysicallyBasedMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  defaultMaterial<span class="token punctuation">.</span>baseColor<span class="token punctuation">.</span>tint <span class="token operator">=</span> <span class="token punctuation">.</span>orange
  defaultMaterial<span class="token punctuation">.</span>roughness <span class="token operator">=</span> <span class="token class-name">PhysicallyBasedMaterial</span><span class="token punctuation">.</span><span class="token class-name">Roughness</span><span class="token punctuation">(</span>floatLiteral<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> piece <span class="token operator">=</span> <span class="token class-name">ModelEntity</span><span class="token punctuation">(</span>
      mesh<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">generateBox</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> pieceWidth<span class="token punctuation">,</span> height<span class="token punctuation">:</span> pieceHeight<span class="token punctuation">,</span> depth<span class="token punctuation">:</span> pieceDepth<span class="token punctuation">,</span> cornerRadius<span class="token punctuation">:</span> <span class="token number">0.005</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      materials<span class="token punctuation">:</span> <span class="token punctuation">[</span>defaultMaterial<span class="token punctuation">]</span>
  <span class="token punctuation">)</span>

  <span class="token comment">// Shadow</span>
  piece<span class="token punctuation">.</span>components<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token class-name">GroundingShadowComponent</span><span class="token punctuation">(</span>castsShadow<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// Input</span>
  piece<span class="token punctuation">.</span>components<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token class-name">InputTargetComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// Hover effect</span>
  piece<span class="token punctuation">.</span>components<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token class-name">HoverEffectComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// Configure and apply gestures component</span>
  <span class="token keyword">let</span> jsonData <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"""
  {
      "canDrag": true,
      "pivotOnDrag": true,
      "preserveOrientationOnPivotDrag": true,
      "canScale": false,
      "canRotate": true
  }
  """</span></span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span>

  <span class="token keyword">do</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> decoder <span class="token operator">=</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> gestureComponent <span class="token operator">=</span> <span class="token keyword">try</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">GestureComponent</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> jsonData<span class="token punctuation">)</span>
      piece<span class="token punctuation">.</span>components<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>gestureComponent<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Failed to decode JSON: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Collisions</span>
  piece<span class="token punctuation">.</span><span class="token function">generateCollisionShapes</span><span class="token punctuation">(</span>recursive<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token comment">// Physics</span>
  <span class="token keyword">let</span> physicsMaterial <span class="token operator">=</span> <span class="token class-name">PhysicsMaterialResource</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>
      staticFriction<span class="token punctuation">:</span> <span class="token number">0.35</span><span class="token punctuation">,</span>
      dynamicFriction<span class="token punctuation">:</span> <span class="token number">0.25</span><span class="token punctuation">,</span>
      restitution<span class="token punctuation">:</span> <span class="token number">0.5</span>
  <span class="token punctuation">)</span>
  piece<span class="token punctuation">.</span>components<span class="token punctuation">[</span><span class="token class-name">PhysicsBodyComponent</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>
      massProperties<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>shape<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">generateBox</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> pieceWidth<span class="token punctuation">,</span> height<span class="token punctuation">:</span> pieceHeight<span class="token punctuation">,</span> depth<span class="token punctuation">:</span> pieceDepth<span class="token punctuation">)</span><span class="token punctuation">,</span> mass<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      material<span class="token punctuation">:</span> physicsMaterial<span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">dynamic</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> piece
<span class="token punctuation">}</span></code></pre>
<p>This method sets up a <code>piece</code> and adds all the needed components to let them be dragged, fall with gravity and more.</p>
<h2 id="generating-the-tower" tabindex="-1">Generating the tower <a class="header-anchor" href="#generating-the-tower">#</a></h2>
<p>We need to create a tower from a set of pieces. To do this let's set up a method:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">SharedViewModel</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... other code</span>
  <span class="token keyword">var</span> tower <span class="token operator">=</span> <span class="token class-name">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">func</span> <span class="token function-definition function">generateTower</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> numberOfPieces <span class="token operator">=</span> numberOfRows <span class="token operator">*</span> <span class="token number">3</span>
      tower<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> startingPositionX
      tower<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> startingPositionY
      tower<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> startingPositionZ

      <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..&lt;</span>numberOfPieces <span class="token punctuation">{</span>
          <span class="token keyword">let</span> piece <span class="token operator">=</span> <span class="token function">generatePiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          piece<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"piece-</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i <span class="token operator">+</span> <span class="token number">1</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>

          <span class="token comment">// Position the piece in place</span>
          <span class="token function">positionPiece</span><span class="token punctuation">(</span>index<span class="token punctuation">:</span> i<span class="token punctuation">,</span> piece<span class="token punctuation">:</span> piece<span class="token punctuation">)</span>
          tower<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>piece<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      tower<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation <span class="token operator">=</span> <span class="token function">simd_quatf</span><span class="token punctuation">(</span>angle<span class="token punctuation">:</span> <span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">,</span> axis<span class="token punctuation">:</span> SIMD3<span class="token operator">&lt;</span><span class="token class-name">Float</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Rotate 45 degrees around the y-axis</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>We add a <code>tower</code> of type <code>Entity</code>. This is defined in the class so it can later be used to reset the pieces.</p>
<p>The first method to use it is <code>generateTower</code>, which positions the entity based on the starting positions, then loops through the required number of pieces and adds them to the entity. We need to create the method that positions the piece.</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">positionPiece</span><span class="token punctuation">(</span>index<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> piece<span class="token punctuation">:</span> <span class="token class-name">ModelEntity</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rowIndex <span class="token operator">=</span> index <span class="token operator">/</span> <span class="token number">3</span>
    <span class="token keyword">let</span> pieceIndexInGroup <span class="token operator">=</span> index <span class="token operator">%</span> <span class="token number">3</span>

    <span class="token keyword">if</span> rowIndex <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        piece<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">(</span>pieceIndexInGroup<span class="token punctuation">)</span> <span class="token operator">*</span> pieceWidth
        piece<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Odd row: align along z-axis</span>
        piece<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> pieceWidth
        piece<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Float</span><span class="token punctuation">(</span>pieceIndexInGroup<span class="token punctuation">)</span> <span class="token operator">*</span> pieceWidth<span class="token punctuation">)</span> <span class="token operator">-</span> pieceWidth
        piece<span class="token punctuation">.</span>orientation <span class="token operator">=</span> <span class="token function">simd_quatf</span><span class="token punctuation">(</span>angle<span class="token punctuation">:</span> <span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> axis<span class="token punctuation">:</span> SIMD3<span class="token operator">&lt;</span><span class="token class-name">Float</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Rotate 90 degrees around the y-axis</span>
    <span class="token punctuation">}</span>

    piece<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Float</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">)</span> <span class="token operator">*</span> pieceHeight<span class="token punctuation">)</span> <span class="token operator">-</span> pieceHeight
<span class="token punctuation">}</span></code></pre>
<p>This method makes use of the index of the given <code>piece</code>. It works out which row the piece is in and its position in the row. It then turns the piece 90 degrees for every odd-numbered row so that they alternate. These positions are relatvie to the containing <code>tower</code> entity.</p>
<p>Lastly we build the tower when the shared view model initialises.</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">generateTower</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="placing-the-tower" tabindex="-1">Placing the tower <a class="header-anchor" href="#placing-the-tower">#</a></h2>
<p>With the tower full of pieces we need to place it on the table. Back in <code>ImmersiveView</code>, add the tower to the content:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token class-name">RealityView</span> <span class="token punctuation">{</span> content <span class="token keyword">in</span>
    <span class="token comment">// ... other code</span>
    <span class="token comment">// Add pieces</span>
    content<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>tower<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="rest-game-button" tabindex="-1">Rest game button <a class="header-anchor" href="#rest-game-button">#</a></h2>
<p>We should now have a workable Jenga tower. The next step is to have some way to reset it. Add a <code>reset</code> method to the <code>SharedViewModel</code>:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> child <span class="token keyword">in</span> tower<span class="token punctuation">.</span>children <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> modelEntity <span class="token operator">=</span> child <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">ModelEntity</span> <span class="token punctuation">{</span>
            child<span class="token punctuation">.</span>orientation <span class="token operator">=</span> <span class="token function">simd_quatf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">positionPiece</span><span class="token punctuation">(</span>index<span class="token punctuation">:</span> i<span class="token punctuation">,</span> piece<span class="token punctuation">:</span> modelEntity<span class="token punctuation">)</span>
            i <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>This method resets the orientation of the pieces (try it without it - creates a fun explosion) then runs the <code>positionPiece</code> method on each piece to put it back into the starting position.</p>
<h2 id="congrats" tabindex="-1">Congrats! <a class="header-anchor" href="#congrats">#</a></h2>
<p>This was a big one. In this post we've put together several concepts, including creating an immersive view, adding gestures, physics, collisions, and used a shared view model to control the state of a game.</p>
<p>If you found this post useful, don't forget to subscribe below! I'll email occasionally when I've something new to share.</p>

<ul class="links-nextprev"><li>Previous: <a href="/hover-effect/">Simple hover effect</a></li><li>Next: <a href="/loading-material-from-scene/">Loading material from Reality Composer Pro scene</a></li>
</ul>
</div>

		</main>

		<footer class="panel padded">
			<div class="signup">
				<h2>Donovan's Vision Newsletter</h2>
				<p>Stay up to date when new posts land</p>
				<div class="signup-frame">
					<iframe
					src="https://embeds.beehiiv.com/e4b485a8-6ae4-48c8-a4aa-e699ebbc193f?slim=true"
					data-test-id="beehiiv-embed"
					height="52"
					width="100%"
					frameborder="0"
					scrolling="no"
					style="margin: 1rem 0 2rem; border-radius: 0px !important; background-color: transparent;"
					></iframe>
				</div>
			</div>
			<nav class="panel secondary">
					<h2 class="visually-hidden">Footer navigation menu</h2>
					<ul class="nav">
						<li class="nav-item"><a href="/">Home</a></li>
						<li class="nav-item"><a href="/blog/">All Posts</a></li>
						<li class="nav-item"><a href="/links/">Cool Links</a></li>
					</ul>
				</nav>
				<p>This website is built on <a href="http://eleventy-base-blog.netlify.app">Eleventy Base Blog</a> with a few small tweaks.</p>

			<p>Thanks for reading, be sure to check out <a href="/feed/feed.xml">the RSS feed</a>.</p>
				<p>All content @2024 <a href="https://hop.ie">Donovan Hutchinson</a></p>
		</footer>

		<!-- Current page: /jenga-in-vision-os/ -->
	</body>
</html>
