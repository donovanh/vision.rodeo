<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>TabletopKit - Donovan's Vision Blog</title>
		<meta name="description" content="Getting some of the pieces in place to start using a Tabletop app.">
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/site.webmanifest">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Donovan’s Vision Blog">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="Donovan’s Vision Blog">

		<meta name="fediverse:creator" content="@donovanh@mastodon.ie" />

		<meta property="og:title" content="TabletopKit" />
		<meta property="og:type" content="article" />
		<meta property="og:description" content="Getting some of the pieces in place to start using a Tabletop app.">
		<meta property="og:url" content="" />
		<meta name="generator" content="Eleventy v2.0.1">
		<style>/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
* { box-sizing: border-box; }
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono,
		Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono,
		Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New,
		Courier, monospace;
}

/* Theme colors */
:root {
	/* --color-gray-90: rgba(255, 255, 255, 0.25);
	--color-gray-70: rgba(255, 255, 255, 0.7);
	--color-gray-50: rgba(255, 255, 255, 0.5);
	--color-gray-20: rgba(255, 255, 255, 0.2);

	--background-color: rgba(128, 255, 255, 0.5);

	--text-color: #222;
	--text-color-link: rgba(168, 10, 221, 0.8);
	--text-color-link-active: rgba(168, 10, 221, 1);
	--text-color-link-visited: rgba(168, 10, 221, 0.7);

	--syntax-tab-size: 2; */
	--color-gray-90: rgba(255, 255, 255, 0.1);
	--color-gray-70: rgba(255, 255, 255, 0.3);
	--color-gray-50: rgba(255, 255, 255, 0.5);
	--color-gray-20: rgba(255, 255, 255, 0.8);

	--background-color: rgb(2, 0, 20);

	--text-color: #eee;
	--text-color-link: rgba(241, 233, 255, 0.8);
	--text-color-link-active: rgba(241, 233, 255, 1);
	--text-color-link-visited: rgba(241, 233, 255, 0.5);
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-90: rgba(255, 255, 255, 0.1);
		--color-gray-70: rgba(255, 255, 255, 0.3);
		--color-gray-50: rgba(255, 255, 255, 0.5);
		--color-gray-20: rgba(255, 255, 255, 0.8);

		--background-color: rgb(2, 0, 20);

		--text-color: #eee;
		--text-color-link: rgba(241, 233, 255, 0.8);
		--text-color-link-active: rgba(241, 233, 255, 1);
		--text-color-link-visited: rgba(241, 233, 255, 0.5);
	}
}

/* Global stylesheet */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	font-size: 1.15em;

	background: var(--background-color);
	background-size: 100vw;
	background-repeat: no-repeat;
}
html {
	overflow-y: scroll;
}

@media (max-width: 90rem) {
	html,
	body {
		font-size: 1em;
	}
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.75;
}

li {
	line-height: 1.75;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main {
	padding: 1rem 0;
}

.links-nextprev {
	list-style: none;
	padding: 1em 0;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

.callout {
	background: var(--color-gray-90);
	border-radius: 0.25rem;
	padding: 1rem;
	margin: 1rem;
	text-align: center;
}

pre,
code {
	background: var(--color-gray-90);
	border-radius: 0.25rem;
	padding: 0.25rem;
	font-family: var(--font-family-monospace);
	word-break: break-word;
}
p code,
li code,
pre code {
	font-size: 0.75rem;
}
pre:where([class*="language-"]) {
	margin: 2rem 0 !important;
	width: 100%;
}
pre:not([class*="language-"]) {
	margin: 0.5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
}

.panel {
	background-color: var(--color-gray-90);
	box-shadow: -0.25px -0.25px 0.25px 0 rgba(255, 255, 255, 0.15);
	border-radius: 2rem;
	position: relative;
	backdrop-filter: blur(20px);
	-webkit-backdrop-filter: blur(20px);
}

.padded {
	padding: 2rem;
}

@media (max-width: 500px) {
	.padded {
		padding: 1rem;
	}
}

/* Header */
.header-container {
	perspective: 100vw;
	perspective-origin: 50% 30vh;
	transform-style: preserve-3d;
}
header {
	text-align: center;
	align-items: center;
	padding: 4rem 0;
	margin: 2rem auto 4rem;
	max-width: 90rem;
	z-index: 128;
}

@media (max-width: 90rem) {
	header {
		margin: 2rem 1rem 3rem;
	}
}

@media (max-width: 40rem) {
	header.panel {
		background: none;
		box-shadow: none;
		backdrop-filter: none;
		-webkit-backdrop-filter: none;
		margin: 2rem 1rem;
	}
}

.wordart {
	display: inline-block;
	margin: 2rem 0 4rem;
	font-size: 9vw;
	text-shadow: none;
	background: linear-gradient(
		183deg,
		rgba(183, 0, 255, 0.7) 10%,
		rgba(255, 21, 200, 0.7) 70%
	);
	background-clip: text;
	-webkit-background-clip: text;
	color: transparent;
	font-family: "Impact";
	transform: skewY(-8deg) scaleY(1.3) scaleX(0.8);
	-webkit-text-stroke: 1px rgba(0, 0, 0, 0.15);
}

.wordart-wrapper {
	filter: drop-shadow(2px 2px 0px rgba(2, 5, 42, 0.8));
}

@media (min-width: 1400px) {
	.wordart {
		font-size: 8rem;
	}
}

/* Nav */
nav {
	max-width: 22rem;
	margin: 0 auto;
	margin-bottom: -8rem;
}
nav.secondary {
	margin: 1rem auto 2rem;
}
.nav {
	display: flex;
	justify-content: space-between;
	padding: 1.5rem 1rem;
	list-style: none;
}
.nav-item {
	display: inline-block;
	padding: 0 1rem;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}

@media (max-width: 40rem) {
	nav {
		margin-bottom: -7rem;
	}
}

/* Internal header */
header {
	display: flex;
	max-width: 100%;
	padding: 0;
	margin: 0;
}

header .home-link {
	width: 300px;
	margin-right: auto;
}

header .wordart {
	font-size: 2rem;
	margin: 0;
}

header nav {
	background: none;
	box-shadow: none;
	filter: none;
	-webkit-backdrop-filter: none;
	max-width: 100%;
	margin: 2rem;
}

header ul.nav {
	padding: 1rem 0 0;
}

@media (max-width: 500px) {
	header,
	header.panel {
		display: block;
		max-width: 100%;
		padding: 0;
		margin: 2rem 0 0;
	}

	header .wordart {
		font-size: 2rem;
		margin: 0;
	}

	header nav {
		display: none;
	}
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
}
.home.postlist {
	display: flex;
	flex-wrap: wrap;
	padding: 0 2rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
}

.home .postlist-item {
	background: var(--color-gray-90);
	margin: 1rem;
	max-width: calc(33% - 2rem);
	width: 100%;
	padding: 2rem;
}

@media (max-width: 70rem) {
	.home .postlist-item {
		max-width: calc(50% - 2rem);
	}
}

@media (max-width: 48rem) {
	.home .postlist-item {
		max-width: 100%;
	}
}

.home .postlist-item h1 {
	margin: 0;
	line-height: 1.25em;
	text-wrap: balance;
}

.nested .postlist-item {
	padding-top: 0;
	padding-bottom: 0;
}
.postlist-item time {
	width: 100%;
}
.postlist-item img,
main img {
	max-width: 100%;
	height: auto;
	margin: 3rem 0;
	border-radius: 2rem;
	box-shadow: -0.25px -0.25px 0.25px 0 rgba(255, 255, 255, 0.5),
		0 0 1rem 0 rgba(0, 0, 0, 0.2);
}

.video-wrapper {
	width: 100%;
}
main video {
	display: block;
	max-width: 80%;
	height: auto;
	border-radius: 2rem;
	box-shadow: -0.25px -0.25px 0.25px 0 rgba(255, 255, 255, 0.5),
		0 0 1rem 0 rgba(0, 0, 0, 0.2);
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-20);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}
.postlist h2,
.postlist h3,
.postlist h4 {
	display: block;
	width: 100%;
}

.more-posts {
	text-align: center;
	margin: 2rem 0;
}

.content {
	max-width: 54rem;
	margin-left: auto;
	margin-right: auto;
}
.content h2,
.content h3,
.content h4 {
	margin-top: 2rem;
	margin-bottom: 0;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	text-decoration: none;
	background: var(--color-gray-90);
	padding: 0.25rem 0.5rem;
	border: 0.5px solid rgba(0, 0, 0, 0.25);
	border-radius: 1rem;
	font-size: 0.75em; /* 12px /16 */
	opacity: 0.5;
}
.post-tag:hover {
	opacity: 1;
	transition: opacity 0.25s ease-out;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: 0.5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	/* color: rgba(0, 0, 0, 0.5); */
	color: rgba(255, 255, 255, 0.75);
	font-size: 1rem;
	margin-right: 1em;
}

@media (prefers-color-scheme: dark) {
	.post-metadata time {
		color: rgba(255, 255, 255, 0.75);
	}
}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: 0.1em;
	text-shadow: none;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

main h1,
main h2,
main h3,
main h4 {
	font-family: var(--font-family);
	width: 100%;
	text-wrap: balance;
}

.content h1 {
	font-size: 4rem;
}

main h2 {
	font-size: 1.75em;
}

main h3 {
	font-size: 1.5em;
}

@media (max-width: 500px) {
	.content h1 {
		text-align: center;
	}
}

h2 + .header-anchor {
	font-size: 1.75em;
}

footer {
	max-width: 80rem;
	margin: 2rem auto;
	text-align: center;
}

footer.panel {
	background: var(--color-gray-90);
}

@media (max-width: 90rem) {
	footer {
		margin: 1rem;
	}
}

.signup-frame {
	max-width: 375px;
	margin: 0 auto;
}

@media (max-width: 30rem) {
	.imgur-embed-iframe-pub {
		margin: 0 -2rem !important;
		max-width: calc(100% + 4rem);
	}
}</style>
		<script src="/js/on-scroll.js"></script>
	</head>
	<body>
		<div class="bodyBackground"></div>
		<a href="#skip" class="visually-hidden">Skip to main content</a>
			<header class="internal">
				<a href="/" class="home-link">
					<span class="wordart-wrapper">
						<span class="wordart">Donovan’s Vision Blog</span>
					</span>
				</a>
				<nav>
					<h2 class="visually-hidden">Top level navigation menu</h2>
					<ul class="nav">
						<li class="nav-item"><a href="/blog/">All Posts</a></li>
					</ul>
				</nav>
			</header>
		<main id="skip" class="">
			

<div class="content panel padded">
	<h1>TabletopKit</h1>

<ul class="post-metadata">
	<li><time datetime="2025-03-16">16 March 2025</time></li>
	<li><a href="/tags/dev/" class="post-tag">dev</a></li>
</ul>

<div class="callout"><a href="https://apps.apple.com/app/blockstack/id6670283686">BlockStack for Vision Pro is now available!</a></div>

<p>For a while I've been looking for a way to make my <a href="https://blockstack.hop.ie">BlockStack vision pro game</a> a multiplayer experience. Currently it's just a simple one-player game but it would be more fun if played with others.</p>
<p>To make this happen, Apple has a framework called <a href="https://developer.apple.com/design/human-interface-guidelines/shareplay">Shareplay</a>. I've been trying to work with it, but so far haven't been able to work out how to get it to share... or play. As an alternative, I'm looking into a framework specifically designed to wrap Shareplay and enable <code>tabletop</code> gaming, called <a href="https://developer.apple.com/documentation/tabletopkit">TabletopKit</a>.</p>
<p>This is also tricky but having watched a <a href="/arctic-2025-day-2/#mikaela-caron-creating-games-with-tabletopkit-for-visionos">talk from Mikaela Caron</a> on creating a TabletopKit game, I thought I should go back to basics and try to learn this framework.</p>
<p>With that in mind, here's what I've learned so far. I've set up the following code as a <a href="https://github.com/donovanh/tabletopkitexample">Git repo here</a>.</p>
<h2 id="result" tabindex="-1">Result <a class="header-anchor" href="#result">#</a></h2>
<blockquote class="imgur-embed-pub" lang="en" data-id="a/mYLLdov" data-context="false" ><a href="//imgur.com/a/mYLLdov">Blockstack in TabletopKit</a></blockquote><script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script>
<p>In building this demo I have learned that while <code>TabletopKit</code> has many useful tools, it's not a great fit for a physics-based project such as Blockstack.</p>
<p>The pieces can clip through others. They don't push other pieces over or fall using physics. There may be ways around this but this is as far as I've got so far.</p>
<p>However, the setup below might prove useful when starting new projects.</p>
<h2 id="tabletopkit-setup" tabindex="-1">TabletopKit setup <a class="header-anchor" href="#tabletopkit-setup">#</a></h2>
<p>A TabletopKit app needs the following in place:</p>
<ul>
<li>A volumetric window</li>
<li>A table</li>
<li>Seats at the table</li>
<li>Equipment (the parts of the game people interact with)</li>
<li>Interaction logic</li>
<li>Observation logic</li>
<li>SharePlay</li>
</ul>
<h3 id="setting-up-app-with-volumetric-window" tabindex="-1">Setting up app with Volumetric window <a class="header-anchor" href="#setting-up-app-with-volumetric-window">#</a></h3>
<p>The app begins with the <code>App</code>, which contains a single <code>WindowGroup</code> set to display out <code>GameView</code> as a volumetric window:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">Scene</span> <span class="token punctuation">{</span>
    <span class="token class-name">WindowGroup</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"game"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GameView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">volumeBaseplateVisibility</span><span class="token punctuation">(</span><span class="token punctuation">.</span>hidden<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">windowStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>volumetric<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">volumeWorldAlignment</span><span class="token punctuation">(</span><span class="token punctuation">.</span>gravityAligned<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">defaultSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> depth<span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>meters<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>This won't work out of the box, as one other setup step is to update <code>Info.plist</code> and set <code>Preferred Default Scene Session Role</code> to <code>Volumetric Window Application Session Role</code>.</p>
<p>Now when the app runs, it'll open a volumetric window as the only window.</p>
<h3 id="gameview" tabindex="-1">GameView <a class="header-anchor" href="#gameview">#</a></h3>
<p>Our <code>GameView</code> is where the game is to be displayed. It uses a <code>RealityView</code> into which the game loads all <code>entities</code>:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">RealityKit</span>
<span class="token keyword">import</span> <span class="token class-name">RealityKitContent</span>
<span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>
<span class="token keyword">import</span> <span class="token class-name">TabletopKit</span>

<span class="token attribute atrule">@MainActor</span>
<span class="token keyword">struct</span> <span class="token class-name">GameView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> game<span class="token punctuation">:</span> <span class="token class-name">Game</span><span class="token operator">?</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> activityManager<span class="token punctuation">:</span> <span class="token class-name">GroupActivityManager</span><span class="token operator">?</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
        <span class="token class-name">ZStack</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> loadedGame <span class="token operator">=</span> game <span class="token punctuation">{</span>
                <span class="token class-name">RealityView</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">RealityViewContent</span><span class="token punctuation">)</span> <span class="token keyword">in</span>
                    content<span class="token punctuation">.</span>entities<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>loadedGame<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>root<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token punctuation">.</span><span class="token function">tabletopGame</span><span class="token punctuation">(</span>loadedGame<span class="token punctuation">.</span>tabletopGame<span class="token punctuation">,</span> parent<span class="token punctuation">:</span> loadedGame<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
                    <span class="token class-name">GameInteraction</span><span class="token punctuation">(</span>game<span class="token punctuation">:</span> loadedGame<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span>task <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>game <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>activityManager <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>tabletopGame<span class="token punctuation">:</span> game<span class="token operator">!</span><span class="token punctuation">.</span>tabletopGame<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>The code above runs a <code>task</code> that loads the game. It also instantiates the <code>GroupActivityManager</code>, which handles Shareplay.</p>
<p>Lastly the <code>RealityView</code> has a <code>tabletopGame</code> modifier which sets up the game interaction logic.</p>
<h3 id="game" tabindex="-1">Game <a class="header-anchor" href="#game">#</a></h3>
<p>The <code>GameView</code> calls the <code>Game</code> class. This brings together the setup of the <code>tabletop</code> and <code>renderer</code>, adds observers, renderers and sets up the initial seating.</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token attribute atrule">@Observable</span>
<span class="token keyword">class</span> <span class="token class-name">Game</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tabletopGame<span class="token punctuation">:</span> <span class="token class-name">TabletopGame</span>
    <span class="token keyword">let</span> renderer<span class="token punctuation">:</span> <span class="token class-name">GameRenderer</span>
    <span class="token keyword">let</span> observer<span class="token punctuation">:</span> <span class="token class-name">GameObserver</span>
    <span class="token keyword">let</span> setup<span class="token punctuation">:</span> <span class="token class-name">GameSetup</span>

    <span class="token attribute atrule">@MainActor</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        renderer <span class="token operator">=</span> <span class="token class-name">GameRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        setup <span class="token operator">=</span> <span class="token class-name">GameSetup</span><span class="token punctuation">(</span>root<span class="token punctuation">:</span> renderer<span class="token punctuation">.</span>root<span class="token punctuation">)</span>

        tabletopGame <span class="token operator">=</span> <span class="token class-name">TabletopGame</span><span class="token punctuation">(</span>tableSetup<span class="token punctuation">:</span> setup<span class="token punctuation">.</span>setup<span class="token punctuation">)</span>

        observer <span class="token operator">=</span> <span class="token class-name">GameObserver</span><span class="token punctuation">(</span>tabletop<span class="token punctuation">:</span> tabletopGame<span class="token punctuation">,</span> renderer<span class="token punctuation">:</span> renderer<span class="token punctuation">)</span>
        tabletopGame<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span>

        tabletopGame<span class="token punctuation">.</span><span class="token function">addRenderDelegate</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span>
        renderer<span class="token punctuation">.</span>game <span class="token operator">=</span> <span class="token keyword">self</span>

        tabletopGame<span class="token punctuation">.</span><span class="token function">claimAnySeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">deinit</span> <span class="token punctuation">{</span>
        tabletopGame<span class="token punctuation">.</span><span class="token function">removeObserver</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span>
        tabletopGame<span class="token punctuation">.</span><span class="token function">removeRenderDelegate</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="gamerenderer" tabindex="-1">GameRenderer <a class="header-anchor" href="#gamerenderer">#</a></h3>
<p>The game renders through a root <code>entity</code>. I've adjusted it to rotate the table 45 degrees to better see the result:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token attribute atrule">@MainActor</span>
<span class="token keyword">class</span> <span class="token class-name">GameRenderer</span><span class="token punctuation">:</span> <span class="token class-name">TabletopGame</span><span class="token punctuation">.</span><span class="token class-name">RenderDelegate</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> root<span class="token punctuation">:</span> <span class="token class-name">Entity</span>
    <span class="token keyword">let</span> rootOffset<span class="token punctuation">:</span> <span class="token class-name">Vector3D</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">GameMetrics</span><span class="token punctuation">.</span>tableThickness<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">weak</span> <span class="token keyword">var</span> game<span class="token punctuation">:</span> <span class="token class-name">Game</span><span class="token operator">?</span>

    <span class="token attribute atrule">@MainActor</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        root <span class="token operator">=</span> <span class="token class-name">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        root<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>translation <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>rootOffset<span class="token punctuation">)</span>

        <span class="token keyword">let</span> rotation <span class="token operator">=</span> <span class="token function">simd_quatf</span><span class="token punctuation">(</span>angle<span class="token punctuation">:</span> <span class="token class-name">Float</span><span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">,</span> axis<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        root<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation <span class="token operator">=</span> rotation
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="gamesetup" tabindex="-1">GameSetup <a class="header-anchor" href="#gamesetup">#</a></h3>
<p>The minimum setup requires a table and seating. This is enough to get a tabletop kit app to run (and some testing blocks to illustrate the interactions):</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token attribute atrule">@MainActor</span>
<span class="token keyword">class</span> <span class="token class-name">GameSetup</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> root<span class="token punctuation">:</span> <span class="token class-name">Entity</span>
    <span class="token keyword">var</span> setup<span class="token punctuation">:</span> <span class="token class-name">TableSetup</span>
    <span class="token keyword">var</span> seats<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">PlayerSeat</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span>root<span class="token punctuation">:</span> <span class="token class-name">Entity</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>root <span class="token operator">=</span> root
        setup <span class="token operator">=</span> <span class="token class-name">TableSetup</span><span class="token punctuation">(</span>tabletop<span class="token punctuation">:</span> <span class="token class-name">Table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment">// Adding player seats</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>index<span class="token punctuation">,</span> pose<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token class-name">PlayerSeat</span><span class="token punctuation">.</span>seatPoses<span class="token punctuation">.</span><span class="token function">enumerated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> seat <span class="token operator">=</span> <span class="token class-name">PlayerSeat</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token class-name">TableSeatIdentifier</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span> pose<span class="token punctuation">:</span> pose<span class="token punctuation">)</span>
            seats<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>seat<span class="token punctuation">)</span>
            setup<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>seat<span class="token punctuation">:</span> seat<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Adding some blocks for testing</span>
        <span class="token keyword">let</span> blockWidth<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">0.04</span>

        <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">30</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> orientation<span class="token punctuation">:</span> <span class="token class-name">Float</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
                orientation <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                orientation <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">2</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">let</span> row <span class="token operator">=</span> index <span class="token operator">/</span> <span class="token number">3</span>
            <span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token class-name">Double</span>
            <span class="token keyword">let</span> z<span class="token punctuation">:</span> <span class="token class-name">Double</span>

            <span class="token keyword">if</span> row <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
                x <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">(</span>index <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> blockWidth
                z <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                x <span class="token operator">=</span> blockWidth
                z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">(</span>index <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> blockWidth<span class="token punctuation">)</span> <span class="token operator">-</span> blockWidth
            <span class="token punctuation">}</span>

            <span class="token keyword">let</span> blockPosition <span class="token operator">=</span> <span class="token class-name">TableVisualState</span><span class="token punctuation">.</span><span class="token class-name">Point2D</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> x<span class="token punctuation">,</span> z<span class="token punctuation">:</span> z<span class="token punctuation">)</span>
            <span class="token keyword">let</span> block <span class="token operator">=</span> <span class="token class-name">Block</span><span class="token punctuation">(</span>index<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>idGenerator<span class="token punctuation">.</span><span class="token function">newId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> position<span class="token punctuation">:</span> blockPosition<span class="token punctuation">,</span> orientation<span class="token punctuation">:</span> orientation<span class="token punctuation">)</span>

            setup<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>equipment<span class="token punctuation">:</span> block<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="blocks" tabindex="-1">Blocks <a class="header-anchor" href="#blocks">#</a></h3>
<p>While not part of <code>TabletopKit</code>, I wanted something to test the interaction so the following is used to generate the blocks (<code>Block</code> class above):</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">generateBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">ModelEntity</span> <span class="token punctuation">{</span>

    <span class="token keyword">let</span> pieceWidth<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">0.0375</span>
    <span class="token keyword">let</span> pieceHeight<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">0.0225</span>
    <span class="token keyword">let</span> pieceLength<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">0.1125</span>

    <span class="token keyword">var</span> metallicMaterial <span class="token operator">=</span> <span class="token class-name">SimpleMaterial</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>gray<span class="token punctuation">,</span> isMetallic<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    metallicMaterial<span class="token punctuation">.</span>metallic <span class="token operator">=</span> <span class="token class-name">MaterialScalarParameter</span><span class="token punctuation">(</span>floatLiteral<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">)</span>
    metallicMaterial<span class="token punctuation">.</span>roughness <span class="token operator">=</span> <span class="token class-name">MaterialScalarParameter</span><span class="token punctuation">(</span>floatLiteral<span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> boxShape<span class="token punctuation">:</span> <span class="token class-name">MeshResource</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token function">generateBox</span><span class="token punctuation">(</span>
        width<span class="token punctuation">:</span> pieceWidth<span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> pieceHeight<span class="token punctuation">,</span>
        depth<span class="token punctuation">:</span> pieceLength<span class="token punctuation">,</span>
        cornerRadius<span class="token punctuation">:</span> <span class="token number">0.0025</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">let</span> piece <span class="token operator">=</span> <span class="token class-name">ModelEntity</span><span class="token punctuation">(</span>
        mesh<span class="token punctuation">:</span> boxShape<span class="token punctuation">,</span>
        materials<span class="token punctuation">:</span> <span class="token punctuation">[</span>metallicMaterial<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>

    <span class="token comment">// Physics</span>
    <span class="token keyword">let</span> physicsMaterial <span class="token operator">=</span> <span class="token class-name">PhysicsMaterialResource</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>
        staticFriction<span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
        dynamicFriction<span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
        restitution<span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">)</span>

    piece<span class="token punctuation">.</span>components<span class="token punctuation">[</span><span class="token class-name">PhysicsBodyComponent</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>
        massProperties<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>
            shape<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">generateBox</span><span class="token punctuation">(</span>
                width<span class="token punctuation">:</span> pieceWidth<span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> pieceHeight<span class="token punctuation">,</span>
                depth<span class="token punctuation">:</span> pieceLength
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            mass<span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        material<span class="token punctuation">:</span> physicsMaterial<span class="token punctuation">,</span>
        mode<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">static</span>
    <span class="token punctuation">)</span>

    <span class="token comment">// Shadow</span>
    piece<span class="token punctuation">.</span>components<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token class-name">GroundingShadowComponent</span><span class="token punctuation">(</span>castsShadow<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// Input</span>
    piece<span class="token punctuation">.</span>components<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token class-name">InputTargetComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// Sound</span>
    piece<span class="token punctuation">.</span>spatialAudio <span class="token operator">=</span> <span class="token class-name">SpatialAudioComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Collisions</span>
    piece<span class="token punctuation">.</span><span class="token function">generateCollisionShapes</span><span class="token punctuation">(</span>recursive<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> piece
<span class="token punctuation">}</span></code></pre>
<h3 id="gamemetrics" tabindex="-1">GameMetrics <a class="header-anchor" href="#gamemetrics">#</a></h3>
<p>To make configuration easier, we set up some shared variables:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">enum</span> <span class="token class-name">GameMetrics</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> tableEdge<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> tableThickness<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">0.025</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> radius<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">0.35</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="adding-game-equipment" tabindex="-1">Adding game equipment <a class="header-anchor" href="#adding-game-equipment">#</a></h3>
<p>With the game view, setup logic and rendering logic, we can add the basic <code>equipment</code>. In this case it's a simple round table and a seating plan (with 3 seats):</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">extension</span> <span class="token class-name">EquipmentIdentifier</span> <span class="token punctuation">{</span>
     <span class="token keyword">static</span> <span class="token keyword">var</span> tableID<span class="token punctuation">:</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">Table</span><span class="token punctuation">:</span> <span class="token class-name">EntityTabletop</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> shape<span class="token punctuation">:</span> <span class="token class-name">TabletopShape</span>
    <span class="token keyword">var</span> entity<span class="token punctuation">:</span> <span class="token class-name">Entity</span>
    <span class="token keyword">var</span> id<span class="token punctuation">:</span> <span class="token class-name">EquipmentIdentifier</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> newTableEntity <span class="token operator">=</span> <span class="token class-name">ModelEntity</span><span class="token punctuation">(</span>
            mesh<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">generateCylinder</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token class-name">GameMetrics</span><span class="token punctuation">.</span>tableThickness<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token class-name">GameMetrics</span><span class="token punctuation">.</span>radius<span class="token punctuation">)</span><span class="token punctuation">,</span>
            materials<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">SimpleMaterial</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>brown<span class="token punctuation">,</span> isMetallic<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
        newTableEntity<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"table"</span></span>

        <span class="token keyword">self</span><span class="token punctuation">.</span>entity <span class="token operator">=</span> newTableEntity
        <span class="token keyword">self</span><span class="token punctuation">.</span>shape <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>entity<span class="token punctuation">:</span> entity<span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token punctuation">.</span>tableID
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">Block</span><span class="token punctuation">:</span> <span class="token class-name">EntityEquipment</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> id<span class="token punctuation">:</span> <span class="token class-name">EquipmentIdentifier</span>
    <span class="token keyword">var</span> entity<span class="token punctuation">:</span> <span class="token class-name">Entity</span>
    <span class="token keyword">var</span> initialState<span class="token punctuation">:</span> <span class="token class-name">BaseEquipmentState</span>

    <span class="token attribute atrule">@MainActor</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>index<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> position<span class="token punctuation">:</span> <span class="token class-name">TableVisualState</span><span class="token punctuation">.</span><span class="token class-name">Point2D</span><span class="token punctuation">,</span> orientation<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        id <span class="token operator">=</span> <span class="token class-name">EquipmentIdentifier</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>

        <span class="token keyword">let</span> newEntity <span class="token operator">=</span> <span class="token function">generateBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        newEntity<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Block-</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">index</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>

        <span class="token keyword">let</span> rotation <span class="token operator">=</span> <span class="token class-name">Angle2D</span><span class="token punctuation">(</span>radians<span class="token punctuation">:</span> orientation<span class="token punctuation">)</span>

        initialState <span class="token operator">=</span> <span class="token class-name">State</span><span class="token punctuation">(</span>
            parentID<span class="token punctuation">:</span> <span class="token punctuation">.</span>tableID<span class="token punctuation">,</span>
            pose<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>position<span class="token punctuation">:</span> position<span class="token punctuation">,</span> rotation<span class="token punctuation">:</span> rotation<span class="token punctuation">)</span><span class="token punctuation">,</span>
            entity<span class="token punctuation">:</span> newEntity
        <span class="token punctuation">)</span>
        entity <span class="token operator">=</span> newEntity
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

 <span class="token keyword">struct</span> <span class="token class-name">PlayerSeat</span><span class="token punctuation">:</span> <span class="token class-name">TableSeat</span> <span class="token punctuation">{</span>
     <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token constant">ID</span>
     <span class="token keyword">var</span> initialState<span class="token punctuation">:</span> <span class="token class-name">TableSeatState</span>

     <span class="token attribute atrule">@MainActor</span> <span class="token keyword">static</span> <span class="token keyword">let</span> seatPoses<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">TableVisualState</span><span class="token punctuation">.</span><span class="token class-name">Pose2D</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
         <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>position<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">(</span><span class="token class-name">GameMetrics</span><span class="token punctuation">.</span>tableEdge<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rotation<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">degrees</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>position<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token class-name">Double</span><span class="token punctuation">(</span><span class="token class-name">GameMetrics</span><span class="token punctuation">.</span>tableEdge<span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rotation<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">degrees</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>position<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">(</span><span class="token class-name">GameMetrics</span><span class="token punctuation">.</span>tableEdge<span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rotation<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">degrees</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">]</span>

     <span class="token keyword">init</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token class-name">TableSeatIdentifier</span><span class="token punctuation">,</span> pose<span class="token punctuation">:</span> <span class="token class-name">TableVisualState</span><span class="token punctuation">.</span><span class="token class-name">Pose2D</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">self</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id
         <span class="token keyword">let</span> spatialSeatPose<span class="token punctuation">:</span> <span class="token class-name">TableVisualState</span><span class="token punctuation">.</span><span class="token class-name">Pose2D</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>position<span class="token punctuation">:</span> pose<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                                                              rotation<span class="token punctuation">:</span> pose<span class="token punctuation">.</span>rotation<span class="token punctuation">)</span>
         initialState <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>pose<span class="token punctuation">:</span> spatialSeatPose<span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span></code></pre>
<p>There are different types of equipment. When using entities for custom equipment, <code>EntityEquipment</code> is ideal. In the example above, I have added a sinple <code>Block</code> struct so we can add some interactive elements.</p>
<p><code>TabletopKit</code> also brings useful tools such as dice.</p>
<h3 id="gameinteraction" tabindex="-1">GameInteraction <a class="header-anchor" href="#gameinteraction">#</a></h3>
<p>With the equipment in place, we can add some boilerplate for when we want interactions.</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">GameInteraction</span><span class="token punctuation">:</span> <span class="token class-name">TabletopInteraction</span><span class="token punctuation">.</span><span class="token class-name">Delegate</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> game<span class="token punctuation">:</span> <span class="token class-name">Game</span>

    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span>interaction<span class="token punctuation">:</span> <span class="token class-name">TabletopKit</span><span class="token punctuation">.</span><span class="token class-name">TabletopInteraction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> equipment <span class="token operator">=</span> interaction<span class="token punctuation">.</span>value<span class="token punctuation">.</span>controlledEquipmentID
        <span class="token keyword">guard</span> <span class="token keyword">let</span> destination <span class="token operator">=</span> interaction<span class="token punctuation">.</span>value<span class="token punctuation">.</span>proposedDestination <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> interaction<span class="token punctuation">.</span>value<span class="token punctuation">.</span>phase <span class="token operator">==</span> <span class="token punctuation">.</span>ended <span class="token punctuation">{</span>
            interaction<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">moveEquipment</span><span class="token punctuation">(</span>matching<span class="token punctuation">:</span> equipment<span class="token punctuation">,</span> childOf<span class="token punctuation">:</span> destination<span class="token punctuation">.</span>equipmentID<span class="token punctuation">,</span> pose<span class="token punctuation">:</span> destination<span class="token punctuation">.</span>pose<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>This makes use of an <code>update</code> method that passes an <code>interaction.value.phase</code> that can be <code>.started</code> or <code>.ended</code> along with an <code>interaction.value.gesture?.phase</code> for more control. In this code we move the equipment to where it is left.</p>
<p>Restrictions on where equipment can be moved can be configured.</p>
<h3 id="gameobserver" tabindex="-1">GameObserver <a class="header-anchor" href="#gameobserver">#</a></h3>
<p>The interactions set up <code>actions</code>, as above in <code>interaction.addAction</code>. These can be observed in the <code>GameObserver</code> class for other actions such as updating game state.</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">GameObserver</span><span class="token punctuation">:</span> <span class="token class-name">TabletopGame</span><span class="token punctuation">.</span><span class="token class-name">Observer</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tabletop<span class="token punctuation">:</span> <span class="token class-name">TabletopGame</span>
    <span class="token keyword">let</span> renderer<span class="token punctuation">:</span> <span class="token class-name">GameRenderer</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span>tabletop<span class="token punctuation">:</span> <span class="token class-name">TabletopGame</span><span class="token punctuation">,</span> renderer<span class="token punctuation">:</span> <span class="token class-name">GameRenderer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tabletop <span class="token operator">=</span> tabletop
        <span class="token keyword">self</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> renderer
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">actionIsPending</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> action<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">TabletopAction</span><span class="token punctuation">,</span> oldSnapshot<span class="token punctuation">:</span> <span class="token class-name">TableSnapshot</span><span class="token punctuation">,</span> newSnapshot<span class="token punctuation">:</span> <span class="token class-name">TableSnapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> action <span class="token operator">=</span> action <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">MoveEquipmentAction</span> <span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"actionIsPending:  </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">action</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">actionWasConfirmed</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> action<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">TabletopAction</span><span class="token punctuation">,</span> oldSnapshot<span class="token punctuation">:</span> <span class="token class-name">TableSnapshot</span><span class="token punctuation">,</span> newSnapshot<span class="token punctuation">:</span> <span class="token class-name">TableSnapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"actionWasConfirmed:  </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">action</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">playerChangedSeats</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> player<span class="token punctuation">:</span> <span class="token class-name">Player</span><span class="token punctuation">,</span> oldSeat<span class="token punctuation">:</span> <span class="token punctuation">(</span>any <span class="token class-name">TableSeat</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span> newSeat<span class="token punctuation">:</span> <span class="token punctuation">(</span>any <span class="token class-name">TableSeat</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span> snapshot<span class="token punctuation">:</span> <span class="token class-name">TableSnapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> player<span class="token punctuation">.</span>id <span class="token operator">==</span> tabletop<span class="token punctuation">.</span>localPlayer<span class="token punctuation">.</span>id<span class="token punctuation">,</span> newSeat <span class="token operator">==</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span>
            tabletop<span class="token punctuation">.</span><span class="token function">claimAnySeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="groupactivitymanager" tabindex="-1">GroupActivityManager <a class="header-anchor" href="#groupactivitymanager">#</a></h3>
<p>To bring it all together, we set up a group activity session:</p>
<pre class="language-swift" tabindex="0"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">GroupActivities</span>
<span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>
<span class="token attribute atrule">@preconcurrency</span> <span class="token keyword">import</span> <span class="token class-name">TabletopKit</span>

<span class="token keyword">struct</span> <span class="token class-name">Activity</span><span class="token punctuation">:</span> <span class="token class-name">GroupActivity</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> metadata<span class="token punctuation">:</span> <span class="token class-name">GroupActivityMetadata</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> metadata <span class="token operator">=</span> <span class="token class-name">GroupActivityMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        metadata<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token punctuation">.</span>generic
        metadata<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"TabletopKitExample"</span></span>
        <span class="token keyword">return</span> metadata
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">GroupActivityManager</span><span class="token punctuation">:</span> <span class="token class-name">Observable</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> tabletopGame<span class="token punctuation">:</span> <span class="token class-name">TabletopGame</span>
    <span class="token keyword">var</span> sessionTask <span class="token operator">=</span> <span class="token class-name">Task</span><span class="token operator">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span>tabletopGame<span class="token punctuation">:</span> <span class="token class-name">TabletopGame</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tabletopGame <span class="token operator">=</span> tabletopGame
        sessionTask <span class="token operator">=</span> <span class="token class-name">Task</span> <span class="token punctuation">{</span> <span class="token attribute atrule">@MainActor</span> <span class="token keyword">in</span>
            <span class="token keyword">for</span> <span class="token keyword">await</span> session <span class="token keyword">in</span> <span class="token class-name">Activity</span><span class="token punctuation">.</span><span class="token function">sessions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                tabletopGame<span class="token punctuation">.</span><span class="token function">coordinateWithSession</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">deinit</span> <span class="token punctuation">{</span>
        tabletopGame<span class="token punctuation">.</span><span class="token function">detachNetworkCoordinator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>You can see the <a href="https://github.com/donovanh/tabletopkitexample">full project on Github here</a>.</p>

<ul class="links-nextprev"><li>Previous: <a href="/arctic-2025-day-2/">ARCtic iOS conference 2025 - Day 2</a></li>
</ul>
</div>

		</main>

		<footer class="panel padded">
			<div class="signup">
				<h2>Donovan's Vision Newsletter</h2>
				<p>Stay up to date when new posts land</p>
				<div class="signup-frame">
					<iframe
					src="https://embeds.beehiiv.com/e4b485a8-6ae4-48c8-a4aa-e699ebbc193f?slim=true"
					data-test-id="beehiiv-embed"
					height="52"
					width="100%"
					frameborder="0"
					scrolling="no"
					style="margin: 1rem 0 2rem; border-radius: 0px !important; background-color: transparent;"
					></iframe>
				</div>
			</div>
				<p>Thanks for reading! Follow the <a href="/feed/feed.xml">the RSS feed</a></p>
				<p style="font-size: 0.75rem">All content @2024 <a href="https://hop.ie">Donovan Hutchinson</a></p>
		</footer>

		<!-- Current page: /tabletopkit/ -->
	</body>
</html>
